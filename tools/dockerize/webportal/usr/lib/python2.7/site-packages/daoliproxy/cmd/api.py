import sys

from daoliproxy.openstack.common import log as logging
from daoliproxy.openstack.common.report import guru_meditation_report as gmr
from daoliproxy import service
from daoliproxy import utils
from daoliproxy import config
from daoliproxy import version

def main():
    config.parse_args(sys.argv)
    logging.setup("daoliproxy")
    utils.monkey_patch()

    gmr.TextGuruMeditation.setup_autorun(version)

    launcher = service.process_launcher()
    server = service.WSGIService('daoliproxy')
    launcher.launch_service(server, workers=server.workers or 1)
    launcher.wait()

if __name__ == '__main__':
    main()
